function clockUpdateTime(e,c){function a(){var e,c=new Date,a=s(c.getHours(),2)+":"+s(c.getMinutes(),2)+":"+s(c.getSeconds(),2),n=s(c.getFullYear(),4)+"-"+s(c.getMonth()+1,2)+"-"+s(c.getDate(),2)+" "+r[c.getDay()],t=c.getHours();if(t>12?(t-=12,e=" P M"):e=" A M",document.getElementById("card-clock-time")){var o=document.getElementById("card-clock-time"),l=document.getElementById("card-clock-clockdate"),i=document.getElementById("card-clock-dackorlight");o.innerHTML=a,l.innerHTML=n,i.innerHTML=e}}function s(e,c){for(var a="",s=0;s<c;s++)a+="0";return(a+e).slice(-c)}let n="#000";switch(e.now.icon){case"100":n="#fdcc45";break;case"101":n="#fe6976";break;case"102":case"103":n="#fe7f5b";break;case"104":case"150":case"151":case"152":case"153":case"154":case"800":case"801":case"802":case"803":case"804":case"805":case"806":case"807":n="#2152d1";break;case"300":case"301":case"305":case"306":case"307":case"308":case"309":case"310":case"311":case"312":case"313":case"314":case"315":case"316":case"317":case"318":case"350":case"351":case"399":n="#49b1f5";break;case"302":case"303":case"304":n="#fdcc46";break;case"400":case"401":case"402":case"403":case"404":case"405":case"406":case"407":case"408":case"409":case"410":case"456":case"457":case"499":n="#a3c2dc";break;case"500":case"501":case"502":case"503":case"504":case"507":case"508":case"509":case"510":case"511":case"512":case"513":case"514":case"515":n="#97acba";break;case"900":case"999":n="red";break;case"901":n="#179fff"}var t=document.getElementById("hexo_electric_clock"),o=`\n  <div class="clock-row">\n    <span id="card-clock-clockdate" class="card-clock-clockdate"></span>\n    <span class="card-clock-weather">\n      <i class="qi-${e.now.icon}-fill" style="color: ${n}"></i> ${e.now.text} <span>${e.now.temp}</span> ℃\n    </span>\n    <span class="card-clock-humidity">💧 ${e.now.humidity}%</span>\n  </div>\n  <div class="clock-row">\n    <span id="card-clock-time" class="card-clock-time"></span>\n  </div>\n  <div class="clock-row">\n    <span class="card-clock-windDir"> <i class="qi-gale"></i> ${e.now.windDir}</span>\n    <span class="card-clock-location">${c}</span>\n    <span id="card-clock-dackorlight" class="card-clock-dackorlight"></span>\n  </div>\n  `,r=["SUN","MON","TUE","WED","THU","FRI","SAT"],l=document.getElementById("card-clock-loading");l&&(l.innerHTML=""),t.innerHTML=o,setInterval(a,1e3),a()}function getIpInfo(){function e(e){let a=`https://devapi.qweather.com/v7/weather/now?location=${e}&key=${qweather_key}`;console.log("Fetching weather from: "+a),fetch(a).then(e=>e.ok?e.json():e.json().then(c=>{throw new Error(`HTTP ${e.status}: ${c.code} - ${c.message}`)})).then(e=>{document.getElementById("hexo_electric_clock")&&clockUpdateTime(e,c)}).catch(e=>{console.error("❌ 天气请求失败:",e.message),e.message.includes("401")&&console.warn("⚠️ 可能的原因: API Key 无效/过期，请检查 QWeather 开发者平台")})}let c="长沙市",a="";"true"===clock_default_rectangle_enable?(a=clock_rectangle,fetch(`https://restapi.amap.com/v3/geocode/regeo?key=${gaud_map_key}&location=${clock_rectangle}`).then(e=>e.json()).then(s=>{if("1"===s.status){const e=s.regeocode.addressComponent;c=Array.isArray(e.city)?e.province:e.city}e(a)}).catch(c=>{console.error("Error fetching geocode:",c),e(a)})):fetch(`https://restapi.amap.com/v3/ip?key=${gaud_map_key}`).then(e=>e.json()).then(s=>{a=s.rectangle?Array.isArray(s.rectangle)?clock_rectangle:s.rectangle.split(";")[0]:clock_rectangle,s.rectangle&&!Array.isArray(s.rectangle)?fetch(`https://restapi.amap.com/v3/geocode/regeo?key=${gaud_map_key}&location=${clock_rectangle}`).then(e=>e.json()).then(s=>{if("1"===s.status){const e=s.regeocode.addressComponent;c=Array.isArray(e.city)?e.province:e.city}e(a)}).catch(c=>{console.error("Error fetching geocode:",c),e(a)}):e(a)}).catch(c=>{console.error("Error fetching IP info:",c),e(clock_rectangle)})}getIpInfo();